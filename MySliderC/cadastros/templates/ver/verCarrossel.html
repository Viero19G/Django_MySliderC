{% extends 'paginas/modelo.html' %}
{% load static %}
{% load custom_filters %}

{% block conteudo %}
<!-- Carrossel de Imagens e Vídeos dos Arquivos de Referência ao Conteúdo -->
{% if grade.conteudo.exists %}
<div id="carouselExampleInterval" class="carousel slide text-center shadow" data-bs-ride="carousel">
  <div class="carousel-inner">
    {% for conteudo in grade.conteudo.all %}
    {% if conteudo.tipo == 'video' and conteudo.video.video.url|slice:'-4:' == '.mp4' %}

    <div class="carousel-item {% if forloop.first %}active{% endif %}"
      data-bs-interval="{{ conteudo.video.tempo|multiply:1000 }}">
      <video class="slide-video" controls style="max-height: 100vh; width: 100%; object-fit: contain;">
        <source src="{{ conteudo.video.video.url }}" type="video/mp4">
        Seu navegador não suporta o formato de Vídeo.
      </video>
    </div>

    {% elif conteudo.tipo == 'imagem' %}

    <div class="carousel-item {% if forloop.first %}active{% endif %}"
      data-bs-interval="{{ conteudo.imagem.tempo |multiply:1000 }}">
      <img src="{{ conteudo.imagem.image.url }}" style="max-height: 100vh; width: 100%; object-fit: contain;">
    </div>

    {% endif %}
    {% endfor %}
  </div>
  <a class="carousel-control-prev" href="#carouselExampleInterval" role="button" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Anterior</span>
  </a>
  <a class="carousel-control-next" href="#carouselExampleInterval" role="button" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Próximo</span>
  </a>

</div>


{% else %}
<div class="text-center mt-3">
  <p>Grade vazia</p>
</div>
{% endif %}
{% endblock %}

{% block scripts %}

<script>
var currentVideo = null;

$('#carouselExampleInterval').on('slide.bs.carousel', function (e) {
    // Obtém o vídeo atual
    var video = $(this).find('.carousel-item.active video')[0];
    
    if (video) {
        // Verifica se o vídeo está sendo pausado enquanto ainda está no slide atual
        if (currentVideo === video) {
            return;  // Evita a pausa se o vídeo for o mesmo
        }

        // Pausa o vídeo atual
        if (currentVideo) {
            currentVideo.pause();
        }
    }
});

$('#carouselExampleInterval').on('slid.bs.carousel', function () {
    // Quando um novo slide (vídeo) foi exibido, inicie a reprodução do vídeo atual
    var video = $(this).find('.carousel-item.active video')[0];
    if (video) {
        video.play();
        currentVideo = video;
    }
});
</script>
{% endblock %}
